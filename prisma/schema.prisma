// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ServiceOrderStatus {
  REQUESTED
  RECEIVED
  IN_DIAGNOSIS
  AWAITING_APPROVAL
  APPROVED
  REJECTED
  SCHEDULED
  IN_EXECUTION
  FINISHED
  DELIVERED
  CANCELLED
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

model ServiceOrder {
  id                   String              @id @default(uuid())
  status               ServiceOrderStatus  @default(REQUESTED)
  requestDate          DateTime            @default(now())
  deliveryDate         DateTime?
  cancellationReason   String?
  notes                String?
  clientId             String
  vehicleId            String
  client               Client              @relation(fields: [clientId], references: [id])
  vehicle              Vehicle             @relation(fields: [vehicleId], references: [id])
  vehicleEvaluations   VehicleEvaluation[]
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt

  @@index([clientId])
  @@index([vehicleId])
  @@index([status])
  @@index([requestDate])
  @@map("service_orders")
}

model Client {
  id            String         @id @default(uuid())
  name          String
  email         String         @unique
  cpfCnpj       String         @unique
  phone         String?
  address       String?
  vehicles      Vehicle[]
  serviceOrders ServiceOrder[]
  appointments  Appointment[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([email])
  @@index([cpfCnpj])
  @@map("clients")
}

model Vehicle {
  id            String         @id @default(uuid())
  licensePlate  String         @unique
  make          String
  model         String
  year          Int
  vin           String?        @unique
  color         String?
  clientId      String
  client        Client         @relation(fields: [clientId], references: [id])
  serviceOrders ServiceOrder[]
  appointments  Appointment[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([clientId])
  @@index([licensePlate])
  @@map("vehicles")
}

model VehicleEvaluation {
  id              String       @id @default(uuid())
  serviceOrderId  String
  evaluationNotes String?
  photos          String[]     // Array of photo URLs
  conditionScore  Int?         // 1-10 score
  mileage         Int?
  fuelLevel       String?      // EMPTY, QUARTER, HALF, THREE_QUARTERS, FULL
  serviceOrder    ServiceOrder @relation(fields: [serviceOrderId], references: [id])
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([serviceOrderId])
  @@map("vehicle_evaluations")
}

model Appointment {
  id              String            @id @default(uuid())
  scheduledDate   DateTime
  scheduledTime   String            // HH:MM format
  status          AppointmentStatus @default(SCHEDULED)
  notes           String?
  clientId        String
  vehicleId       String
  serviceOrderId  String?           // Optional - linked after creation
  client          Client            @relation(fields: [clientId], references: [id])
  vehicle         Vehicle           @relation(fields: [vehicleId], references: [id])
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([clientId])
  @@index([vehicleId])
  @@index([scheduledDate])
  @@index([status])
  @@map("appointments")
}

model Availability {
  id          String   @id @default(uuid())
  dayOfWeek   Int      // 0-6 (Sunday-Saturday)
  startTime   String   // HH:MM format
  endTime     String   // HH:MM format
  maxCapacity Int      // Max appointments per slot
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([dayOfWeek])
  @@index([isActive])
  @@map("availability")
}
